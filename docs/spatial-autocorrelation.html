<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 14 Spatial Autocorrelation | R Spatial Workshop Notes</title>
  <meta name="description" content="Chapter 14 Spatial Autocorrelation | R Spatial Workshop Notes" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 14 Spatial Autocorrelation | R Spatial Workshop Notes" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="spatialanalysis/workshop-notes" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 14 Spatial Autocorrelation | R Spatial Workshop Notes" />
  
  
  

<meta name="author" content="Angela Li" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="basic-mapping.html">
<link rel="next" href="spatial-autocorrelation-with-rgeoda.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.2/leaflet.js"></script>
<script src="libs/leaflet-providers-1.1.17/leaflet-providers.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.2/leaflet-providers-plugin.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#workshop-organization"><i class="fa fa-check"></i>Workshop Organization</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prior-knowledge"><i class="fa fa-check"></i>Prior Knowledge</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#topics"><i class="fa fa-check"></i>Topics</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#additional-information"><i class="fa fa-check"></i>Additional information</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="project-setup.html"><a href="project-setup.html"><i class="fa fa-check"></i>Project Setup</a><ul>
<li class="chapter" data-level="" data-path="project-setup.html"><a href="project-setup.html#prerequisites-for-git-workflow"><i class="fa fa-check"></i>Prerequisites for Git workflow</a></li>
<li class="chapter" data-level="" data-path="project-setup.html"><a href="project-setup.html#workflow-with-git"><i class="fa fa-check"></i>Workflow with Git</a></li>
<li class="chapter" data-level="" data-path="project-setup.html"><a href="project-setup.html#workflow-without-git"><i class="fa fa-check"></i>Workflow without Git</a></li>
<li class="chapter" data-level="" data-path="project-setup.html"><a href="project-setup.html#additional-reading"><i class="fa fa-check"></i>Additional reading</a></li>
</ul></li>
<li class="part"><span><b>GIS and Spatial Data</b></span></li>
<li class="chapter" data-level="1" data-path="introduction-to-spatial-data.html"><a href="introduction-to-spatial-data.html"><i class="fa fa-check"></i><b>1</b> Introduction to Spatial Data</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-spatial-data.html"><a href="introduction-to-spatial-data.html#learning-objectives"><i class="fa fa-check"></i><b>1.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-spatial-data.html"><a href="introduction-to-spatial-data.html#spatial-data-basics"><i class="fa fa-check"></i><b>1.2</b> Spatial Data Basics</a></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-spatial-data.html"><a href="introduction-to-spatial-data.html#interactive-tutorial"><i class="fa fa-check"></i><b>1.3</b> Interactive Tutorial</a><ul>
<li class="chapter" data-level="1.3.1" data-path="introduction-to-spatial-data.html"><a href="introduction-to-spatial-data.html#functions-learned"><i class="fa fa-check"></i><b>1.3.1</b> Functions learned</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction-to-spatial-data.html"><a href="introduction-to-spatial-data.html#import-spatial-data"><i class="fa fa-check"></i><b>1.3.2</b> Import spatial data</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction-to-spatial-data.html"><a href="introduction-to-spatial-data.html#project-your-data"><i class="fa fa-check"></i><b>1.3.3</b> Project your data</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-spatial-data.html"><a href="introduction-to-spatial-data.html#links"><i class="fa fa-check"></i><b>1.4</b> Links</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="single-dataset-gis-operations.html"><a href="single-dataset-gis-operations.html"><i class="fa fa-check"></i><b>2</b> Single-Dataset GIS Operations</a><ul>
<li class="chapter" data-level="2.1" data-path="single-dataset-gis-operations.html"><a href="single-dataset-gis-operations.html#learning-objectives-1"><i class="fa fa-check"></i><b>2.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="2.2" data-path="single-dataset-gis-operations.html"><a href="single-dataset-gis-operations.html#functions-learned-1"><i class="fa fa-check"></i><b>2.2</b> Functions Learned</a></li>
<li class="chapter" data-level="2.3" data-path="single-dataset-gis-operations.html"><a href="single-dataset-gis-operations.html#interactive-tutorial-1"><i class="fa fa-check"></i><b>2.3</b> Interactive Tutorial</a></li>
<li class="chapter" data-level="2.4" data-path="single-dataset-gis-operations.html"><a href="single-dataset-gis-operations.html#exercises"><i class="fa fa-check"></i><b>2.4</b> Exercises</a></li>
<li class="chapter" data-level="2.5" data-path="single-dataset-gis-operations.html"><a href="single-dataset-gis-operations.html#links-1"><i class="fa fa-check"></i><b>2.5</b> Links</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="multiple-dataset-gis-operations-visualization.html"><a href="multiple-dataset-gis-operations-visualization.html"><i class="fa fa-check"></i><b>3</b> Multiple-Dataset GIS Operations / Visualization</a><ul>
<li class="chapter" data-level="3.1" data-path="multiple-dataset-gis-operations-visualization.html"><a href="multiple-dataset-gis-operations-visualization.html#learning-objectives-2"><i class="fa fa-check"></i><b>3.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="3.2" data-path="multiple-dataset-gis-operations-visualization.html"><a href="multiple-dataset-gis-operations-visualization.html#functions-learned-2"><i class="fa fa-check"></i><b>3.2</b> Functions Learned</a></li>
<li class="chapter" data-level="3.3" data-path="multiple-dataset-gis-operations-visualization.html"><a href="multiple-dataset-gis-operations-visualization.html#interactive-tutorial-2"><i class="fa fa-check"></i><b>3.3</b> Interactive Tutorial</a></li>
<li class="chapter" data-level="3.4" data-path="multiple-dataset-gis-operations-visualization.html"><a href="multiple-dataset-gis-operations-visualization.html#links-2"><i class="fa fa-check"></i><b>3.4</b> Links</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="multiple-dataset-gis-operations-visualization-pt-2.html"><a href="multiple-dataset-gis-operations-visualization-pt-2.html"><i class="fa fa-check"></i><b>4</b> Multiple-Dataset GIS Operations / Visualization pt. 2</a><ul>
<li class="chapter" data-level="4.1" data-path="multiple-dataset-gis-operations-visualization-pt-2.html"><a href="multiple-dataset-gis-operations-visualization-pt-2.html#learning-objectives-3"><i class="fa fa-check"></i><b>4.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="4.2" data-path="multiple-dataset-gis-operations-visualization-pt-2.html"><a href="multiple-dataset-gis-operations-visualization-pt-2.html#functions-learned-3"><i class="fa fa-check"></i><b>4.2</b> Functions Learned</a></li>
<li class="chapter" data-level="4.3" data-path="multiple-dataset-gis-operations-visualization-pt-2.html"><a href="multiple-dataset-gis-operations-visualization-pt-2.html#interactive-tutorial-3"><i class="fa fa-check"></i><b>4.3</b> Interactive Tutorial</a></li>
<li class="chapter" data-level="4.4" data-path="multiple-dataset-gis-operations-visualization-pt-2.html"><a href="multiple-dataset-gis-operations-visualization-pt-2.html#challenges"><i class="fa fa-check"></i><b>4.4</b> Challenges</a><ul>
<li class="chapter" data-level="4.4.1" data-path="multiple-dataset-gis-operations-visualization-pt-2.html"><a href="multiple-dataset-gis-operations-visualization-pt-2.html#a-simple-example"><i class="fa fa-check"></i><b>4.4.1</b> A simple example</a></li>
<li class="chapter" data-level="4.4.2" data-path="multiple-dataset-gis-operations-visualization-pt-2.html"><a href="multiple-dataset-gis-operations-visualization-pt-2.html#saving-your-plots"><i class="fa fa-check"></i><b>4.4.2</b> Saving your plots</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="multiple-dataset-gis-operations-visualization-pt-2.html"><a href="multiple-dataset-gis-operations-visualization-pt-2.html#links-3"><i class="fa fa-check"></i><b>4.5</b> Links</a></li>
</ul></li>
<li class="part"><span><b>Visualization</b></span></li>
<li class="chapter" data-level="5" data-path="r-markdown-and-custom-maps.html"><a href="r-markdown-and-custom-maps.html"><i class="fa fa-check"></i><b>5</b> R Markdown and Custom Maps</a><ul>
<li class="chapter" data-level="5.1" data-path="r-markdown-and-custom-maps.html"><a href="r-markdown-and-custom-maps.html#learning-objectives-4"><i class="fa fa-check"></i><b>5.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="5.2" data-path="r-markdown-and-custom-maps.html"><a href="r-markdown-and-custom-maps.html#topics-learned"><i class="fa fa-check"></i><b>5.2</b> Topics Learned</a></li>
<li class="chapter" data-level="5.3" data-path="r-markdown-and-custom-maps.html"><a href="r-markdown-and-custom-maps.html#interactive-tutorial-4"><i class="fa fa-check"></i><b>5.3</b> Interactive Tutorial</a></li>
<li class="chapter" data-level="5.4" data-path="r-markdown-and-custom-maps.html"><a href="r-markdown-and-custom-maps.html#challenges-1"><i class="fa fa-check"></i><b>5.4</b> Challenges</a></li>
<li class="chapter" data-level="5.5" data-path="r-markdown-and-custom-maps.html"><a href="r-markdown-and-custom-maps.html#links-4"><i class="fa fa-check"></i><b>5.5</b> Links</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="custom-and-animated-maps.html"><a href="custom-and-animated-maps.html"><i class="fa fa-check"></i><b>6</b> Custom and Animated Maps</a><ul>
<li class="chapter" data-level="6.1" data-path="custom-and-animated-maps.html"><a href="custom-and-animated-maps.html#learning-objectives-5"><i class="fa fa-check"></i><b>6.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="6.2" data-path="custom-and-animated-maps.html"><a href="custom-and-animated-maps.html#functions-learned-4"><i class="fa fa-check"></i><b>6.2</b> Functions Learned</a></li>
<li class="chapter" data-level="6.3" data-path="custom-and-animated-maps.html"><a href="custom-and-animated-maps.html#interactive-tutorial-5"><i class="fa fa-check"></i><b>6.3</b> Interactive Tutorial</a></li>
<li class="chapter" data-level="6.4" data-path="custom-and-animated-maps.html"><a href="custom-and-animated-maps.html#challenges-2"><i class="fa fa-check"></i><b>6.4</b> Challenges</a></li>
<li class="chapter" data-level="6.5" data-path="custom-and-animated-maps.html"><a href="custom-and-animated-maps.html#links-5"><i class="fa fa-check"></i><b>6.5</b> Links</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="interactive-maps.html"><a href="interactive-maps.html"><i class="fa fa-check"></i><b>7</b> Interactive Maps</a><ul>
<li class="chapter" data-level="7.1" data-path="interactive-maps.html"><a href="interactive-maps.html#learning-objectives-6"><i class="fa fa-check"></i><b>7.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="7.2" data-path="interactive-maps.html"><a href="interactive-maps.html#functions-learned-5"><i class="fa fa-check"></i><b>7.2</b> Functions Learned</a></li>
<li class="chapter" data-level="7.3" data-path="interactive-maps.html"><a href="interactive-maps.html#overview"><i class="fa fa-check"></i><b>7.3</b> Overview</a></li>
<li class="chapter" data-level="7.4" data-path="interactive-maps.html"><a href="interactive-maps.html#interactive-tutorial-6"><i class="fa fa-check"></i><b>7.4</b> Interactive Tutorial</a></li>
<li class="chapter" data-level="7.5" data-path="interactive-maps.html"><a href="interactive-maps.html#r-training-workshop"><i class="fa fa-check"></i><b>7.5</b> R Training Workshop</a></li>
<li class="chapter" data-level="7.6" data-path="interactive-maps.html"><a href="interactive-maps.html#next-weeks"><i class="fa fa-check"></i><b>7.6</b> Next week(s?)</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="interactive-maps-with-shiny.html"><a href="interactive-maps-with-shiny.html"><i class="fa fa-check"></i><b>8</b> Interactive Maps with Shiny</a><ul>
<li class="chapter" data-level="8.1" data-path="interactive-maps-with-shiny.html"><a href="interactive-maps-with-shiny.html#learning-objectives-7"><i class="fa fa-check"></i><b>8.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="interactive-maps-with-shiny.html"><a href="interactive-maps-with-shiny.html#topics-learned-1"><i class="fa fa-check"></i><b>8.2</b> Topics Learned</a></li>
<li class="chapter" data-level="8.3" data-path="interactive-maps-with-shiny.html"><a href="interactive-maps-with-shiny.html#overview-1"><i class="fa fa-check"></i><b>8.3</b> Overview</a></li>
<li class="chapter" data-level="8.4" data-path="interactive-maps-with-shiny.html"><a href="interactive-maps-with-shiny.html#interactive-tutorial-7"><i class="fa fa-check"></i><b>8.4</b> Interactive Tutorial</a></li>
<li class="chapter" data-level="8.5" data-path="interactive-maps-with-shiny.html"><a href="interactive-maps-with-shiny.html#r-training-workshop-1"><i class="fa fa-check"></i><b>8.5</b> R Training Workshop</a></li>
<li class="chapter" data-level="8.6" data-path="interactive-maps-with-shiny.html"><a href="interactive-maps-with-shiny.html#links-6"><i class="fa fa-check"></i><b>8.6</b> Links</a></li>
</ul></li>
<li class="part"><span><b>Raster Data</b></span></li>
<li class="chapter" data-level="9" data-path="introduction-to-raster-data.html"><a href="introduction-to-raster-data.html"><i class="fa fa-check"></i><b>9</b> Introduction to Raster Data</a><ul>
<li class="chapter" data-level="9.1" data-path="introduction-to-raster-data.html"><a href="introduction-to-raster-data.html#overview-2"><i class="fa fa-check"></i><b>9.1</b> Overview</a></li>
<li class="chapter" data-level="9.2" data-path="introduction-to-raster-data.html"><a href="introduction-to-raster-data.html#links-7"><i class="fa fa-check"></i><b>9.2</b> Links</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="introduction-to-interpolation.html"><a href="introduction-to-interpolation.html"><i class="fa fa-check"></i><b>10</b> Introduction to Interpolation</a><ul>
<li class="chapter" data-level="10.1" data-path="introduction-to-interpolation.html"><a href="introduction-to-interpolation.html#overview-3"><i class="fa fa-check"></i><b>10.1</b> Overview</a></li>
<li class="chapter" data-level="10.2" data-path="introduction-to-interpolation.html"><a href="introduction-to-interpolation.html#make-sure-relevant-packages-are-installed"><i class="fa fa-check"></i><b>10.2</b> Make sure relevant packages are installed</a></li>
<li class="chapter" data-level="10.3" data-path="introduction-to-interpolation.html"><a href="introduction-to-interpolation.html#links-8"><i class="fa fa-check"></i><b>10.3</b> Links</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="interpolation-with-array-of-things-data.html"><a href="interpolation-with-array-of-things-data.html"><i class="fa fa-check"></i><b>11</b> Interpolation with Array of Things Data</a><ul>
<li class="chapter" data-level="11.1" data-path="interpolation-with-array-of-things-data.html"><a href="interpolation-with-array-of-things-data.html#overview-4"><i class="fa fa-check"></i><b>11.1</b> Overview</a></li>
<li class="chapter" data-level="11.2" data-path="interpolation-with-array-of-things-data.html"><a href="interpolation-with-array-of-things-data.html#download-data"><i class="fa fa-check"></i><b>11.2</b> Download data</a></li>
<li class="chapter" data-level="11.3" data-path="interpolation-with-array-of-things-data.html"><a href="interpolation-with-array-of-things-data.html#links-9"><i class="fa fa-check"></i><b>11.3</b> Links</a></li>
</ul></li>
<li class="part"><span><b>Introduction to Spatial Data Science</b></span></li>
<li class="chapter" data-level="12" data-path="spatial-data-handling.html"><a href="spatial-data-handling.html"><i class="fa fa-check"></i><b>12</b> Spatial Data Handling</a><ul>
<li class="chapter" data-level="12.1" data-path="spatial-data-handling.html"><a href="spatial-data-handling.html#learning-objectives-8"><i class="fa fa-check"></i><b>12.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="12.2" data-path="spatial-data-handling.html"><a href="spatial-data-handling.html#functions-learned-6"><i class="fa fa-check"></i><b>12.2</b> Functions Learned</a></li>
<li class="chapter" data-level="12.3" data-path="spatial-data-handling.html"><a href="spatial-data-handling.html#interactive-tutorial-8"><i class="fa fa-check"></i><b>12.3</b> Interactive Tutorial</a></li>
<li class="chapter" data-level="12.4" data-path="spatial-data-handling.html"><a href="spatial-data-handling.html#reading-data-from-an-open-data-portal"><i class="fa fa-check"></i><b>12.4</b> Reading data from an open data portal</a></li>
<li class="chapter" data-level="12.5" data-path="spatial-data-handling.html"><a href="spatial-data-handling.html#selecting-data-to-work-with"><i class="fa fa-check"></i><b>12.5</b> Selecting data to work with</a></li>
<li class="chapter" data-level="12.6" data-path="spatial-data-handling.html"><a href="spatial-data-handling.html#spatial-data-time---my-favorite-part"><i class="fa fa-check"></i><b>12.6</b> Spatial data time - my favorite part!</a></li>
<li class="chapter" data-level="12.7" data-path="spatial-data-handling.html"><a href="spatial-data-handling.html#on-your-own"><i class="fa fa-check"></i><b>12.7</b> On your own</a></li>
<li class="chapter" data-level="12.8" data-path="spatial-data-handling.html"><a href="spatial-data-handling.html#very-important-concepts-projection-and-spatial-join"><i class="fa fa-check"></i><b>12.8</b> Very important concepts: projection, and spatial join</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="basic-mapping.html"><a href="basic-mapping.html"><i class="fa fa-check"></i><b>13</b> Basic Mapping</a><ul>
<li class="chapter" data-level="13.1" data-path="basic-mapping.html"><a href="basic-mapping.html#outline-of-todays-workshop"><i class="fa fa-check"></i><b>13.1</b> Outline of Today’s Workshop</a></li>
<li class="chapter" data-level="13.2" data-path="basic-mapping.html"><a href="basic-mapping.html#spatial-data-handling-fin"><i class="fa fa-check"></i><b>13.2</b> Spatial Data Handling, fin</a></li>
<li class="chapter" data-level="13.3" data-path="basic-mapping.html"><a href="basic-mapping.html#finding-spatial-data"><i class="fa fa-check"></i><b>13.3</b> Finding Spatial Data</a></li>
<li class="chapter" data-level="13.4" data-path="basic-mapping.html"><a href="basic-mapping.html#basic-mapping-1"><i class="fa fa-check"></i><b>13.4</b> Basic Mapping</a><ul>
<li class="chapter" data-level="13.4.1" data-path="basic-mapping.html"><a href="basic-mapping.html#adding-a-basemap"><i class="fa fa-check"></i><b>13.4.1</b> Adding a basemap</a></li>
<li class="chapter" data-level="13.4.2" data-path="basic-mapping.html"><a href="basic-mapping.html#customizing-tmap-function-parameters"><i class="fa fa-check"></i><b>13.4.2</b> Customizing tmap function parameters</a></li>
<li class="chapter" data-level="13.4.3" data-path="basic-mapping.html"><a href="basic-mapping.html#adding-a-histogram"><i class="fa fa-check"></i><b>13.4.3</b> Adding a histogram</a></li>
<li class="chapter" data-level="13.4.4" data-path="basic-mapping.html"><a href="basic-mapping.html#getting-our-map-ready-for-production"><i class="fa fa-check"></i><b>13.4.4</b> Getting our map ready for production</a></li>
<li class="chapter" data-level="13.4.5" data-path="basic-mapping.html"><a href="basic-mapping.html#using-examples"><i class="fa fa-check"></i><b>13.4.5</b> Using Examples</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html"><i class="fa fa-check"></i><b>14</b> Spatial Autocorrelation</a><ul>
<li class="chapter" data-level="14.1" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#install-packages"><i class="fa fa-check"></i><b>14.1</b> Install packages</a></li>
<li class="chapter" data-level="14.2" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#review-from-previous-workshops"><i class="fa fa-check"></i><b>14.2</b> Review from previous workshops</a></li>
<li class="chapter" data-level="14.3" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#spatial-autocorrelation-1"><i class="fa fa-check"></i><b>14.3</b> Spatial autocorrelation</a></li>
<li class="chapter" data-level="14.4" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#do-it-in-r"><i class="fa fa-check"></i><b>14.4</b> Do it in R</a></li>
<li class="chapter" data-level="14.5" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#second-order-contiguity-weights"><i class="fa fa-check"></i><b>14.5</b> Second order contiguity weights</a></li>
<li class="chapter" data-level="14.6" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#distance-band-spatial-weights"><i class="fa fa-check"></i><b>14.6</b> Distance-Band Spatial Weights</a></li>
<li class="chapter" data-level="14.7" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#connectivity-histograms"><i class="fa fa-check"></i><b>14.7</b> Connectivity histograms</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="spatial-autocorrelation-with-rgeoda.html"><a href="spatial-autocorrelation-with-rgeoda.html"><i class="fa fa-check"></i><b>15</b> Spatial Autocorrelation with rgeoda</a><ul>
<li class="chapter" data-level="15.1" data-path="spatial-autocorrelation-with-rgeoda.html"><a href="spatial-autocorrelation-with-rgeoda.html#install-packages-1"><i class="fa fa-check"></i><b>15.1</b> Install packages</a></li>
<li class="chapter" data-level="15.2" data-path="spatial-autocorrelation-with-rgeoda.html"><a href="spatial-autocorrelation-with-rgeoda.html#r-markdown"><i class="fa fa-check"></i><b>15.2</b> R Markdown</a></li>
<li class="chapter" data-level="15.3" data-path="spatial-autocorrelation-with-rgeoda.html"><a href="spatial-autocorrelation-with-rgeoda.html#load-data"><i class="fa fa-check"></i><b>15.3</b> Load data</a></li>
<li class="chapter" data-level="15.4" data-path="spatial-autocorrelation-with-rgeoda.html"><a href="spatial-autocorrelation-with-rgeoda.html#working-with-rgeoda"><i class="fa fa-check"></i><b>15.4</b> Working with rgeoda</a><ul>
<li class="chapter" data-level="15.4.1" data-path="spatial-autocorrelation-with-rgeoda.html"><a href="spatial-autocorrelation-with-rgeoda.html#convert-to-rgeoda-object"><i class="fa fa-check"></i><b>15.4.1</b> Convert to rgeoda object</a></li>
<li class="chapter" data-level="15.4.2" data-path="spatial-autocorrelation-with-rgeoda.html"><a href="spatial-autocorrelation-with-rgeoda.html#looking-at-the-rgeoda-object"><i class="fa fa-check"></i><b>15.4.2</b> Looking at the rgeoda object</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="spatial-autocorrelation-with-rgeoda.html"><a href="spatial-autocorrelation-with-rgeoda.html#spatial-analysis-with-rgeoda"><i class="fa fa-check"></i><b>15.5</b> Spatial Analysis with rgeoda</a><ul>
<li class="chapter" data-level="15.5.1" data-path="spatial-autocorrelation-with-rgeoda.html"><a href="spatial-autocorrelation-with-rgeoda.html#detour-saving-your-weights"><i class="fa fa-check"></i><b>15.5.1</b> Detour: saving your weights</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="spatial-autocorrelation-with-rgeoda.html"><a href="spatial-autocorrelation-with-rgeoda.html#calculating-the-local-moran-statistic"><i class="fa fa-check"></i><b>15.6</b> Calculating the Local Moran statistic</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="spatial-clustering.html"><a href="spatial-clustering.html"><i class="fa fa-check"></i><b>16</b> Spatial Clustering</a><ul>
<li class="chapter" data-level="16.1" data-path="spatial-clustering.html"><a href="spatial-clustering.html#spatial-clustering-in-rgeoda"><i class="fa fa-check"></i><b>16.1</b> Spatial Clustering in rgeoda</a><ul>
<li class="chapter" data-level="16.1.1" data-path="spatial-clustering.html"><a href="spatial-clustering.html#other-algorithms"><i class="fa fa-check"></i><b>16.1.1</b> Other algorithms</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="spatial-clustering.html"><a href="spatial-clustering.html#clustering-analysis-with-other-r-packages"><i class="fa fa-check"></i><b>16.2</b> Clustering analysis with other R packages</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Spatial Workshop Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatial-autocorrelation" class="section level1">
<h1><span class="header-section-number">Chapter 14</span> Spatial Autocorrelation</h1>
<div id="install-packages" class="section level2">
<h2><span class="header-section-number">14.1</span> Install packages</h2>
<p>Make sure you have the <strong>spdep</strong> package installed:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;spdep&quot;</span>)</code></pre>
<p>I also developed a helper package for some of this spatial autocorrelation stuff, called <a href="https://github.com/spatialanalysis/sfExtras"><strong>sfExtras</strong></a>. Install with:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&quot;remotes&quot;)</span>
remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;spatialanalysis/sfExtras&quot;</span>)</code></pre>
</div>
<div id="review-from-previous-workshops" class="section level2">
<h2><span class="header-section-number">14.2</span> Review from previous workshops</h2>
<p>We’ll be working with a new dataset, called “ncovr”. Go ahead and load it with geodaData:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(geodaData)
<span class="kw">library</span>(sf)
<span class="kw">head</span>(ncovr)</code></pre>
<pre><code>## Simple feature collection with 6 features and 69 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -120.8746 ymin: 47.79012 xmax: -94.43044 ymax: 49.37173
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##                NAME STATE_NAME STATE_FIPS CNTY_FIPS  FIPS STFIPS COFIPS
## 1 Lake of the Woods  Minnesota         27       077 27077     27     77
## 2             Ferry Washington         53       019 53019     53     19
## 3           Stevens Washington         53       065 53065     53     65
## 4          Okanogan Washington         53       047 53047     53     47
## 5      Pend Oreille Washington         53       051 53051     53     51
## 6          Boundary      Idaho         16       021 16021     16     21
##   FIPSNO SOUTH     HR60     HR70      HR80      HR90      HC60      HC70
## 1  27077     0 0.000000 0.000000  8.855827  0.000000 0.0000000 0.0000000
## 2  53019     0 0.000000 0.000000 17.208742 15.885624 0.0000000 0.0000000
## 3  53065     0 1.863863 1.915158  3.450775  6.462453 0.3333333 0.3333333
## 4  53047     0 2.612330 1.288643  3.263814  6.996502 0.6666667 0.3333333
## 5  53051     0 0.000000 0.000000  7.770008  7.478033 0.0000000 0.0000000
## 6  16021     0 0.000000 0.000000  4.573101  4.000640 0.0000000 0.0000000
##        HC80      HC90  PO60  PO70  PO80  PO90       RD60       RD70
## 1 0.3333333 0.0000000  4304  3987  3764  4076 -0.1751055 -0.1965356
## 2 1.0000000 1.0000000  3889  3655  5811  6295 -0.8368683 -0.8478556
## 3 1.0000000 2.0000000 17884 17405 28979 30948 -0.5373716 -0.2252831
## 4 1.0000000 2.3333333 25520 25867 30639 33350 -0.8201698 -0.3911261
## 5 0.6666667 0.6666667  6914  6025  8580  8915 -0.9361701 -0.4514569
## 6 0.3333333 0.3333333  5809  5484  7289  8332 -0.8503190 -0.6301795
##          RD80       RD90       PS60       PS70       PS80       PS90 UE60
## 1 -0.36285011 -0.8027737 -1.4499461 -1.4625594 -1.5851232 -1.4955070  7.9
## 2  0.11932743 -0.1354830 -1.7072056 -1.6977199 -1.4440801 -1.3610839  8.2
## 3 -0.51119686 -0.2765439 -0.5681465 -0.5918834 -0.3154613 -0.2831232 10.1
## 4 -0.08242177  0.3707621 -0.5549386 -0.5520160 -0.5253836 -0.4724997  7.5
## 5 -0.28951626  0.1079923 -1.1064386 -1.1817536 -1.0122015 -0.9719778 10.6
## 6 -0.12031784 -0.5515577 -1.2083943 -1.2194174 -1.0980090 -0.9876962 10.8
##   UE70      UE80     UE90     DV60     DV70     DV80      DV90 MA60 MA70
## 1  9.0  5.902579  3.89479 1.858974 2.619808 3.746594  7.388535 28.8 30.5
## 2 15.4 15.422886 16.81159 2.863278 3.686007 6.625442 11.543135 25.9 27.1
## 3  9.0 13.574064 10.70079 2.711447 2.976378 5.448223  9.123212 29.6 31.8
## 4 10.5 12.700195 10.20354 3.372041 4.090386 7.122333  9.245627 29.4 31.1
## 5 13.4 18.148999 14.99102 3.008988 4.010695 5.287860 10.158351 31.2 33.8
## 6 12.1 16.395711 11.37951 2.590420 3.489399 6.071152  8.477287 27.6 30.3
##   MA80 MA90     POL60     POL70     POL80     POL90    DNL60     DNL70
## 1 34.5 35.5  8.367300  8.290794  8.233238  8.312871 1.188755 1.1122489
## 2 27.2 32.8  8.265907  8.203851  8.667508  8.747511 0.568786 0.5067301
## 3 28.7 34.5  9.791662  9.764513 10.274327 10.340064 1.975245 1.9480958
## 4 31.2 35.0 10.147218 10.160723 10.330029 10.414813 1.571567 1.5850725
## 5 31.3 36.1  8.841304  8.703673  9.057189  9.095491 1.595649 1.4580177
## 6 29.2 32.8  8.667164  8.609590  8.894122  9.027859 1.516462 1.4588886
##       DNL80    DNL90   MFIL59   MFIL69   MFIL79   MFIL89 FP59 FP69
## 1 1.0660453 1.145294 8.220134 8.708309 9.551729 10.27921 36.3 16.1
## 2 0.9712953 1.049482 8.519790 9.006754 9.679719 10.25397 22.5 11.6
## 3 2.4623128 2.524736 8.403352 8.868835 9.739379 10.26270 30.9 15.9
## 4 1.7581014 1.845350 8.479907 8.969923 9.715228 10.04962 25.0 12.9
## 5 1.8129617 1.850906 8.508354 8.895219 9.648466 10.11144 26.7 18.3
## 6 1.7488466 1.882032 8.423102 8.946505 9.604745 10.13809 27.2 11.1
##       FP79     FP89      BLK60      BLK70      BLK80      BLK90      GI59
## 1 13.37047  8.51419 0.44144981 0.47654878 0.05313496 0.02453386 0.2852352
## 2 18.63395 17.52451 0.07714065 2.29822161 0.55067975 0.31771247 0.2561578
## 3 11.22669 13.58268 0.07828226 0.09192761 0.09317092 0.21002973 0.2839986
## 4 12.19627 16.94620 0.09796238 0.28221286 0.10117824 0.15592204 0.2585395
## 5 12.59607 15.93098 0.02892682 0.01659751 0.06993007 0.13460460 0.2432630
## 6 14.78873 10.63830 0.00000000 0.05470460 0.04115791 0.03600576 0.2619386
##        GI69      GI79      GI89      FH60 FH70      FH80      FH90
## 1 0.3723362 0.3421036 0.3364546 11.279621  5.4  5.663881  9.515860
## 2 0.3606654 0.3619284 0.3606395 10.053476  2.6 10.079576 11.397059
## 3 0.3940829 0.3575660 0.3699418  9.258437  5.6  6.812127 10.352015
## 4 0.3712182 0.3812402 0.3945189  9.039900  8.1 10.084926 12.840340
## 5 0.3656141 0.3587056 0.3878477  8.243930  4.1  7.557643 10.313002
## 6 0.3503514 0.3559135 0.3405252  7.112971  6.8  8.249497  9.343201
##                         geometry
## 1 MULTIPOLYGON (((-95.34258 4...
## 2 MULTIPOLYGON (((-118.8505 4...
## 3 MULTIPOLYGON (((-117.4378 4...
## 4 MULTIPOLYGON (((-118.971 47...
## 5 MULTIPOLYGON (((-117.4375 4...
## 6 MULTIPOLYGON (((-117.028 48...</code></pre>
<div class="learncheck">
<p>
<strong>Question</strong>
</p>
</div>
<p>Take a few minutes and try to understand what this is about.</p>
<ul>
<li>How many observations and variables are there? What data is stored? (<code>dim()</code>, <code>str()</code>, <code>head()</code>, <code>summary()</code>)</li>
<li>What does the metadata tell you about this data? (<code>?ncovr</code>)</li>
<li>What geometries are in this data? Can you make a quick map with <code>plot()</code>?</li>
<li>What coordinate reference system is there? Is this data projected? (<code>st_crs()</code>)</li>
</ul>
<div class="learncheck">

</div>
<div class="learncheck">
<p>
<strong>Question</strong>
</p>
</div>
<p>Try to make a simple map of one of the attributes of interest (homicides, etc) with tmap. Can you make it interactive?</p>
<div class="learncheck">

</div>
</div>
<div id="spatial-autocorrelation-1" class="section level2">
<h2><span class="header-section-number">14.3</span> Spatial autocorrelation</h2>
<p>We’ll start by talking about spatial weights. There are two main types of spatial weights, contiguity and distance based weights.</p>
<p>We’ll focus on contiguity today: aka, that a spatial unit shares a border with another spatial unit. We look at <strong>rook</strong> vs. <strong>queen</strong> contiguity.</p>
<p><img src="figs/rookvqueen.jpg" /></p>
<p>There’s also second order contiguity:</p>
<p><img src="figs/secondorderrookqueen.jpg" /></p>
<p>How we define “neighbors” matters when we are trying to determine spatial autocorrelation.</p>
</div>
<div id="do-it-in-r" class="section level2">
<h2><span class="header-section-number">14.4</span> Do it in R</h2>
<p>Load two more libraries:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sfExtras)
<span class="kw">library</span>(spdep)</code></pre>
<p>We’ll be using the following functions (potentially buggy):</p>
<pre class="sourceCode r"><code class="sourceCode r">?st_rook
?st_queen
?st_as_nb
?st_centroid_coords <span class="co"># for mapping the weights</span></code></pre>
<p>The code we wrote last week to calculate weights:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tmap)
<span class="kw">tm_shape</span>(ncovr) <span class="op">+</span>
<span class="st">  </span><span class="kw">tm_polygons</span>(<span class="st">&quot;HR60&quot;</span>)</code></pre>
<p><img src="workshop-notes_files/figure-html/unnamed-chunk-183-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r">ncovr_rook &lt;-<span class="st"> </span><span class="kw">st_rook</span>(ncovr)</code></pre>
<pre><code>## although coordinates are longitude/latitude, st_relate_pattern assumes that they are planar</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ncovr_queen &lt;-<span class="st"> </span><span class="kw">st_queen</span>(ncovr)</code></pre>
<pre><code>## although coordinates are longitude/latitude, st_relate_pattern assumes that they are planar</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># check average number of neighbors per county</span>
rook_neighbors &lt;-<span class="st"> </span><span class="kw">lengths</span>(ncovr_rook)
queen_neighbors &lt;-<span class="st"> </span><span class="kw">lengths</span>(ncovr_queen)

<span class="kw">mean</span>(rook_neighbors) <span class="co"># 5.6 ish</span></code></pre>
<pre><code>## [1] 5.571475</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(queen_neighbors) <span class="co"># 5.8 ish</span></code></pre>
<pre><code>## [1] 5.889141</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># convert lists of neighbors to &quot;nb&quot; object to make map</span>
rook_nb &lt;-<span class="st"> </span><span class="kw">st_as_nb</span>(ncovr_rook)
<span class="kw">summary</span>(rook_nb)</code></pre>
<pre><code>## Neighbour list object:
## Number of regions: 3085 
## Number of nonzero links: 17188 
## Percentage nonzero weights: 0.1805989 
## Average number of links: 5.571475 
## Link number distribution:
## 
##    1    2    3    4    5    6    7    8    9   10   11   13 
##   24   41  108  377  863 1007  484  136   37    6    1    1 
## 24 least connected regions:
## 45 49 585 643 837 1197 1377 1402 1442 1464 1470 1523 1531 1532 1543 1596 1605 1653 1737 1767 1775 2892 2893 2919 with 1 link
## 1 most connected region:
## 606 with 13 links</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">queen_nb &lt;-<span class="st"> </span><span class="kw">st_as_nb</span>(ncovr_queen)
<span class="kw">summary</span>(queen_nb)</code></pre>
<pre><code>## Neighbour list object:
## Number of regions: 3085 
## Number of nonzero links: 18168 
## Percentage nonzero weights: 0.190896 
## Average number of links: 5.889141 
## Link number distribution:
## 
##    1    2    3    4    5    6    7    8    9   10   11   13   14 
##   24   36   91  281  620 1037  704  227   50   11    2    1    1 
## 24 least connected regions:
## 45 49 585 643 837 1197 1377 1402 1442 1464 1470 1523 1531 1532 1543 1596 1605 1653 1737 1767 1775 2892 2893 2919 with 1 link
## 1 most connected region:
## 1371 with 14 links</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">centroid_coords &lt;-<span class="st"> </span><span class="kw">st_centroid_coords</span>(ncovr)

<span class="kw">plot</span>(queen_nb, centroid_coords, <span class="dt">lwd =</span> <span class="fl">0.2</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</code></pre>
<p><img src="workshop-notes_files/figure-html/unnamed-chunk-183-2.png" width="672" /></p>
</div>
<div id="second-order-contiguity-weights" class="section level2">
<h2><span class="header-section-number">14.5</span> Second order contiguity weights</h2>
</div>
<div id="distance-band-spatial-weights" class="section level2">
<h2><span class="header-section-number">14.6</span> Distance-Band Spatial Weights</h2>
<p>To match the <a href="https://geodacenter.github.io/workbook/4b_dist_weights/lab4b.html">GeoDa documentation</a>, we’ll be using a dataset called “clev_pts”. Go ahead and load it with geodaData (if you can’t, you can download it from the <a href="https://geodacenter.github.io/data-and-lab//clev_sls_154_core/">Data and Lab website</a>):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(geodaData)
<span class="kw">library</span>(sf)
<span class="kw">head</span>(clev_pts)</code></pre>
<pre><code>## Simple feature collection with 6 features and 9 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 2177090 ymin: 662872 xmax: 2182100 ymax: 663462
## epsg (SRID):    3734
## proj4string:    +proj=lcc +lat_1=41.7 +lat_2=40.43333333333333 +lat_0=39.66666666666666 +lon_0=-82.5 +x_0=600000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs
##   unique_id     parcel       x      y sale_price tract10int Quarter year1
## 1      1183 002-02-036 2177340 663165     235500     101200       4  2015
## 2      1198 002-02-053 2177090 662872      65000     101200       4  2015
## 3      1516 002-14-053 2182100 663462      92000     103500       4  2015
## 4      1606 002-15-038 2181090 663162       5000     103400       4  2015
## 5      1612 002-15-043 2181090 663380     116250     103400       4  2015
## 6      1624 002-16-003 2180350 663301     120000     103100       4  2015
##   yrquarter               geometry
## 1       154 POINT (2177340 663165)
## 2       154 POINT (2177090 662872)
## 3       154 POINT (2182100 663462)
## 4       154 POINT (2181090 663162)
## 5       154 POINT (2181090 663380)
## 6       154 POINT (2180350 663301)</code></pre>
<div class="learncheck">
<p>
<strong>Question</strong>
</p>
</div>
<p>Take a few minutes and try to understand what this is about.</p>
<ul>
<li>How many observations and variables are there? What data is stored? (<code>dim()</code>, <code>str()</code>, <code>head()</code>, <code>summary()</code>)</li>
<li>What does the metadata tell you about this data? (<code>?clev_pts</code>)</li>
<li>What geometries are in this data? Can you make a quick map with <code>plot()</code>?</li>
<li>What coordinate reference system is there? Is this data projected? (<code>st_crs()</code>)</li>
</ul>
<div class="learncheck">

</div>
<div class="learncheck">
<p>
<strong>Question</strong>
</p>
</div>
<p>Try to make a simple map of one of the attributes of interest (homicides, etc) with tmap. Can you make it interactive?</p>
<div class="learncheck">

</div>
<p>There are two ways to go about doing distance-based spatial weights, as mentioned in the GeoDa documentation:</p>
<ol style="list-style-type: decimal">
<li>Determine a distance band under which something is considered a neighbor (see below)</li>
<li>Determine the number of neighbors each point should have (distances will vary)</li>
</ol>
<p><img src="figs/distance-band.png" /></p>
<p>We’ll start with the first.</p>
<pre class="sourceCode r"><code class="sourceCode r">?dnearneigh</code></pre>
<p>Let’s specify a bandwidth of 1000.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dnearneigh</span>(clev_pts, <span class="dv">0</span>, <span class="dv">1000</span>)</code></pre>
<pre><code>## Neighbour list object:
## Number of regions: 205 
## Number of nonzero links: 314 
## Percentage nonzero weights: 0.7471743 
## Average number of links: 1.531707 
## 55 regions with no links:
## 3 16 18 20 22 29 30 36 37 55 56 57 58 59 63 64 92 96 111 112 116 117 118 120 121 131 139 140 141 142 145 148 149 150 151 152 153 154 155 156 157 160 163 164 165 166 167 173 174 187 190 197 198 199 200</code></pre>
<div class="learncheck">
<p>
<strong>Question</strong>
</p>
</div>
<p>What units does “1000” refer to? (Hint: check with <code>st_crs</code>!)</p>
<div class="learncheck">

</div>
<p>We can plot this to get a sense of what’s going on. Remember, the syntax for <code>plot()</code> is <code>plot(nb, coord_matrix, options)</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">dist_<span class="dv">1000</span>_nb &lt;-<span class="st"> </span><span class="kw">dnearneigh</span>(clev_pts, <span class="dv">0</span>, <span class="dv">1000</span>)
<span class="kw">plot</span>(dist_<span class="dv">1000</span>_nb, <span class="kw">st_coordinates</span>(clev_pts), <span class="dt">lwd=</span>.<span class="dv">2</span>, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">cex =</span> <span class="fl">.5</span>)</code></pre>
<p><img src="workshop-notes_files/figure-html/unnamed-chunk-193-1.png" width="672" /></p>
<p>Notice how a lot of points are missing neighbors? They’re referred to as “isolates”.</p>
<p>Maybe we want to specify a minimum distance so that each point has a neighbor. This is referred to as the <strong>critical threshold</strong>.</p>
<p>If we want each point to have one neighbor, we can use <code>knearneigh</code>. This (older function) takes in a matrix and returns a matrix, so we need to convert formats.</p>
<pre class="sourceCode r"><code class="sourceCode r">knn_matrix &lt;-<span class="st"> </span><span class="kw">knearneigh</span>(<span class="kw">st_coordinates</span>(clev_pts))</code></pre>
<p>To convert this matrix into a familiar <strong>nb</strong>, we use knn2nb:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">knn2nb</span>(knn_matrix)</code></pre>
<pre><code>## Neighbour list object:
## Number of regions: 205 
## Number of nonzero links: 205 
## Percentage nonzero weights: 0.4878049 
## Average number of links: 1 
## Non-symmetric neighbours list</code></pre>
<p>Now when we plot again, we see each point has a neighbor:</p>
<pre class="sourceCode r"><code class="sourceCode r">k1_nb &lt;-<span class="st"> </span><span class="kw">knn2nb</span>(knn_matrix)
<span class="kw">plot</span>(k1_nb, <span class="kw">st_coordinates</span>(clev_pts), <span class="dt">lwd=</span>.<span class="dv">2</span>, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">cex =</span> <span class="fl">.5</span>)</code></pre>
<p><img src="workshop-notes_files/figure-html/unnamed-chunk-196-1.png" width="672" /></p>
<p>Each point has exactly one neighbor here.</p>
<div class="learncheck">
<p>
<strong>Question</strong>
</p>
</div>
Can you set it so that each point has 6 neighbors? Plot it!
<div class="learncheck">

</div>
<p>Now let’s try doing something different: setting the distance band equal to the critical threshold in <code>dnearneigh()</code>.</p>
<p>The <code>nbdists</code> function will give us the distance between a point and its closest neighbor.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nbdists</span>(k1_nb, <span class="kw">st_coordinates</span>(clev_pts))</code></pre>
<div class="learncheck">
<p>
<strong>Question</strong>
</p>
</div>
Can you find the maximum distance in this list and assign it to a variable called <code>critical_thres</code>? Can you put it into the <code>dnearneigh</code> function and plot a map where we have a fixed distance band of the critical threshold?
<div class="learncheck">

</div>
</div>
<div id="connectivity-histograms" class="section level2">
<h2><span class="header-section-number">14.7</span> Connectivity histograms</h2>
<p>When doing distance band weights, points have different numbers of neighbors, unlike in k-nearest weights. Let’s get the <strong>cardinality</strong> (aka number of neighbors) for each observation</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">card</span>(dist_crit_nb)</code></pre>
<pre><code>##   [1]  9  9 15 15 15 17 15 15 19 18 20 20 20 19 14 17 17 19 13  3  9 10  7
##  [24]  6  6 12 10 10 10 13 16 17 12 16 14 17  9 11 13 11 16 14 17 17 18 13
##  [47] 13 17 18 16 16 24 27 22 17  8  7  5  0 11 11 11 11 11 13 13 13 13 13
##  [70] 16 16 14 14 13 13 10 10  9 10 23 25 32 28 28 26 23 23 32 23 23 21 24
##  [93] 18 18 17 21 15 20 20 22 19 22 22 19 16 18 20 19 19 23 19 29 30  1  1
## [116]  1  1  3  5  3  3  4  9  9  9  9 11 10 11 13 11  8  9 12 16 10  9  7
## [139]  6  6  3  6  8  8  7  7  7  4  6  5  5  3  2  2  2  7  8  8 10  8  6
## [162]  3  2  2  3  2  6  7  8 10 14 14 12 17 16 16 20 19 19 13 17 13 15 12
## [185] 11 14  5  8  9  8 10 12  6  5  4  3  4  1  9  4 13 13 15 15 17</code></pre>
<div class="learncheck">
<p>
<strong>Question</strong>
</p>
</div>
What’s the most common number of neighbors? Try making a ggplot histogram out of this, too.
<div class="learncheck">

</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="basic-mapping.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="spatial-autocorrelation-with-rgeoda.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/spatialanalysis/workshop-notes/edit/master/14-spatial-autocorrelation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
